# Конфигурационный файл

Файл конфигурации Supervisor обычно называется `supervisord.conf`. Он используется как **supervisord**, так и **supervisorctl**. Если какое-либо приложение запускается без параметра **-c** (параметр, который используется для явного указания имени файла конфигурации), приложение будет искать файл с именем `supervisord.conf` в следующих местах в указанном порядке. Он будет использовать первый найденный файл.

1. `../etc/supervisord.conf` (относительно исполняемого файла)
2. `../supervisord.conf` (относительно исполняемого файла)
3. `$CWD/supervisord.conf`
4. `$CWD/etc/supervisord.conf`
5. `/etc/supervisord.conf`
6. `/etc/supervisor/supervisord.conf` (начиная с **Supervisor 3.3.0**)

{% hint style="info" %}
Многие версии **Supervisor**, упакованные для **Debian** и **Ubuntu**, включали патч, который добавлял `/etc/supervisor/supervisord.conf` к путям поиска. Первым пакетом PyPI Supervisor, который включал его, был **Supervisor 3.3.0**.
{% endhint %}

## Формат файла

`supervisord.conf` — это файл в стиле Windows-INI (Python ConfigParser). Он имеет разделы (каждый из которых обозначается `[header]`) и пары ключ/значение внутри разделов. Разделы и их допустимые значения описаны ниже.

### Переменные среды

Переменные среды, присутствующие в среде во время запуска **supervisord**, можно использовать в файле конфигурации с использованием синтаксиса строкового выражения Python `%(ENV_X)s`:

```ini
[program:example]
command=/usr/bin/example --loglevel=%(ENV_LOGLEVEL)s
```

В приведенном выше примере выражение `%(ENV_LOGLEVEL)s` будет расширено до значения переменной среды **LOGLEVEL**.

{% hint style="info" %}
В **Supervisor 3.2** и более поздних версиях выражения `%(ENV_X)s` поддерживаются во всех параметрах. В предыдущих версиях некоторые параметры поддерживают их, но большинство — нет. См. документацию для каждой опции ниже.
{% endhint %}

## Настройки раздела `[unix_http_server]`

Файл `supervisord.conf` содержит раздел с именем `[unix_http_server]`, в котором должны быть вставлены параметры конфигурации для HTTP-сервера, который прослушивает сокет домена **UNIX**. Если в конфигурационном файле нет секции `[unix_http_server]`, HTTP-сервер сокета домена **UNIX** не будет запущен. Допустимые значения конфигурации следующие.

### Секция значений `[unix_http_server]`

**`file`**

Путь к сокету домена **UNIX**, на котором супервизор будет прослушивать запросы **HTTP/XML-RPC**. **supervisorctl** использует XML-RPC для связи с **supervisord** через этот порт. Эта опция может включать значение `%(here)s`, которое расширяется до каталога, в котором был найден файл конфигурации **supervisord**.

_По умолчанию_: `None`.

_Требуется_: Нет.

_Введено_: 3.0

{% hint style="warning" %}
Пример конфигурации, выводимый **echo\_supervisord\_conf**, использует `/tmp/supervisor.sock` в качестве файла сокета. Этот путь приведен только в качестве примера, и, вероятно, его нужно будет изменить на более подходящее для вашей системы место. Некоторые системы периодически удаляют старые файлы в `/tmp`. Если файл сокета будет удален, **supervisorctl** не сможет подключиться к **supervisord**.
{% endhint %}

**`chmod`**

Изменяет биты режима разрешений UNIX сокета домена UNIX на это значение при запуске.

_По умолчанию_: `0700`.

_Требуется_: Нет.

_Введено_: 3.0

**`chown`**

Измените пользователя и группу файла сокета на это значение. Может быть именем пользователя UNIX (например, **chrism**) или именем пользователя UNIX и группой, разделенными двоеточием (например, **chrism:wheel**).

_По умолчанию_: Использутся имя пользователя и группа пользователя, который запускает **supervisord**.

_Требуется_: Нет.

_Введено_: 3.0

**`username`**

Имя пользователя, необходимое для аутентификации на этом HTTP-сервере.

_По умолчанию_: Имя пользователя не требуется.

_Требуется_: Нет.

_Введено_: 3.0

**`password`**

Пароль, необходимый для аутентификации на этом HTTP-сервере. Это может быть пароль в открытом виде или указанный в виде хэша **SHA-1**, если перед ним стоит строка `{SHA}`. Например, `{SHA}82ab876d1387bfafe46cc1c8a2ef074eae50cb1d` — это хранящаяся в SHA версия пароля «thepassword».

Обратите внимание, что хешированный пароль должен быть в шестнадцатеричном формате.

_По умолчанию_: Пароль не требуется.

_Требуется_: Нет.

_Введено_: 3.0

### Пример секции `[unix_http_server]`

```ini
[unix_http_server]
file = /tmp/supervisor.sock
chmod = 0777
chown= nobody:nogroup
username = user
password = 123
```

## Настройки раздела `[inet_http_server]`

Файл `supervisord.conf` содержит раздел с именем `[inet_http_server]`, в котором должны быть вставлены параметры конфигурации для HTTP-сервера, который прослушивает сокет TCP (интернет). Если в конфигурационном файле нет раздела `[inet_http_server]`, HTTP-сервер inet не будет запущен. Допустимые значения конфигурации следующие.

{% hint style="warning" %}
HTTP-сервер inet не включен по умолчанию. Если вы решите включить его, прочтите следующее предупреждение о безопасности. HTTP-сервер inet предназначен для использования только в доверенной среде. Он должен быть привязан только к локальному хосту или доступен только из изолированной доверенной сети. HTTP-сервер inet не поддерживает никакие формы шифрования. HTTP-сервер inet по умолчанию не использует аутентификацию (см. параметры **username=** и **password=**). HTTP-сервером inet можно управлять удаленно из **supervisorctl**. Он также обслуживает веб-интерфейс, который позволяет запускать или останавливать подпроцессы и просматривать журналы подпроцессов. **Никогда не выставляйте HTTP-сервер inet в общедоступный Интернет.**
{% endhint %}

### Секция значений `[inet_http_server]`

**`port`**

Значение TCP **host:port** или (например, `127.0.0.1:9001`), на котором супервизор будет прослушивать запросы **HTTP/XML-RPC**. **supervisorctl** будет использовать XML-RPC для связи с **supervisord** через этот порт. Чтобы прослушивать все интерфейсы машины, используйте `:9001` или `*:9001`. Пожалуйста, прочтите предупреждение о безопасности выше.

_По умолчанию_: Нет по умолчанию.

_Требуется_: Да.

_Введено_: 3.0

**`username`**

Имя пользователя, необходимое для аутентификации на этом HTTP-сервере.

_По умолчанию_: Имя пользователя не требуется.

_Требуется_: Нет.

_Введено_: 3.0

**`password`**

Пароль, необходимый для аутентификации на этом HTTP-сервере. Это может быть пароль в открытом виде или указанный в виде хэша **SHA-1**, если перед ним стоит строка `{SHA}`. Например, `{SHA}82ab876d1387bfafe46cc1c8a2ef074eae50cb1d` — это хранящаяся в SHA версия пароля «thepassword».

Обратите внимание, что хешированный пароль должен быть в шестнадцатеричном формате.

_По умолчанию_: Пароль не требуется.

_Требуется_: Нет.

_Введено_: 3.0

### Пример секции `[inet_http_server]`

```ini
[inet_http_server]
port = 127.0.0.1:9001
username = user
password = 123
```

## Настройки раздела `[supervisord]`

## Настройки раздела `[supervisorctl]`

## Настройки раздела `[program:x]`

## Настройки раздела `[include]`

## Настройки раздела `[group:x]`

## Настройки раздела `[fcgi-program:x]`

## Настройки раздела `[eventlistener:x]`

## Настройки раздела `[rpcinterface:x]`
