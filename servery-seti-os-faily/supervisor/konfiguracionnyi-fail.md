# Конфигурационный файл

Файл конфигурации Supervisor обычно называется `supervisord.conf`. Он используется как **supervisord**, так и **supervisorctl**. Если какое-либо приложение запускается без параметра **-c** (параметр, который используется для явного указания имени файла конфигурации), приложение будет искать файл с именем `supervisord.conf` в следующих местах в указанном порядке. Он будет использовать первый найденный файл.

1. `../etc/supervisord.conf` (относительно исполняемого файла)
2. `../supervisord.conf` (относительно исполняемого файла)
3. `$CWD/supervisord.conf`
4. `$CWD/etc/supervisord.conf`
5. `/etc/supervisord.conf`
6. `/etc/supervisor/supervisord.conf` (начиная с **Supervisor 3.3.0**)

{% hint style="info" %}
Многие версии **Supervisor**, упакованные для **Debian** и **Ubuntu**, включали патч, который добавлял `/etc/supervisor/supervisord.conf` к путям поиска. Первым пакетом PyPI Supervisor, который включал его, был **Supervisor 3.3.0**.
{% endhint %}

## Формат файла

`supervisord.conf` — это файл в стиле Windows-INI (Python ConfigParser). Он имеет разделы (каждый из которых обозначается `[header]`) и пары ключ/значение внутри разделов. Разделы и их допустимые значения описаны ниже.

### Переменные среды

Переменные среды, присутствующие в среде во время запуска **supervisord**, можно использовать в файле конфигурации с использованием синтаксиса строкового выражения Python `%(ENV_X)s`:

```ini
[program:example]
command=/usr/bin/example --loglevel=%(ENV_LOGLEVEL)s
```

В приведенном выше примере выражение `%(ENV_LOGLEVEL)s` будет расширено до значения переменной среды **LOGLEVEL**.

{% hint style="info" %}
В **Supervisor 3.2** и более поздних версиях выражения `%(ENV_X)s` поддерживаются во всех параметрах. В предыдущих версиях некоторые параметры поддерживают их, но большинство — нет. См. документацию для каждой опции ниже.
{% endhint %}

## Настройки раздела `[unix_http_server]`

Файл `supervisord.conf` содержит раздел с именем `[unix_http_server]`, в котором должны быть вставлены параметры конфигурации для HTTP-сервера, который прослушивает сокет домена **UNIX**. Если в конфигурационном файле нет секции `[unix_http_server]`, HTTP-сервер сокета домена **UNIX** не будет запущен. Допустимые значения конфигурации следующие.

### Секция значений `[unix_http_server]`

**`file`**

Путь к сокету домена **UNIX**, на котором супервизор будет прослушивать запросы **HTTP/XML-RPC**. **supervisorctl** использует XML-RPC для связи с **supervisord** через этот порт. Эта опция может включать значение `%(here)s`, которое расширяется до каталога, в котором был найден файл конфигурации **supervisord**.

_По умолчанию_: `None`.

_Требуется_: Нет.

_Введено_: 3.0

{% hint style="warning" %}
Пример конфигурации, выводимый **echo\_supervisord\_conf**, использует `/tmp/supervisor.sock` в качестве файла сокета. Этот путь приведен только в качестве примера, и, вероятно, его нужно будет изменить на более подходящее для вашей системы место. Некоторые системы периодически удаляют старые файлы в `/tmp`. Если файл сокета будет удален, **supervisorctl** не сможет подключиться к **supervisord**.
{% endhint %}

**`chmod`**

Изменяет биты режима разрешений UNIX сокета домена UNIX на это значение при запуске.

_По умолчанию_: `0700`.

_Требуется_: Нет.

_Введено_: 3.0

**`chown`**

Измените пользователя и группу файла сокета на это значение. Может быть именем пользователя UNIX (например, **chrism**) или именем пользователя UNIX и группой, разделенными двоеточием (например, **chrism:wheel**).

_По умолчанию_: Использутся имя пользователя и группа пользователя, который запускает **supervisord**.

_Требуется_: Нет.

_Введено_: 3.0

**`username`**

Имя пользователя, необходимое для аутентификации на этом HTTP-сервере.

_По умолчанию_: Имя пользователя не требуется.

_Требуется_: Нет.

_Введено_: 3.0

**`password`**

Пароль, необходимый для аутентификации на этом HTTP-сервере. Это может быть пароль в открытом виде или указанный в виде хэша **SHA-1**, если перед ним стоит строка `{SHA}`. Например, `{SHA}82ab876d1387bfafe46cc1c8a2ef074eae50cb1d` — это хранящаяся в SHA версия пароля «thepassword».

Обратите внимание, что хешированный пароль должен быть в шестнадцатеричном формате.

_По умолчанию_: Пароль не требуется.

_Требуется_: Нет.

_Введено_: 3.0

### Пример секции `[unix_http_server]`

```ini
[unix_http_server]
file = /tmp/supervisor.sock
chmod = 0777
chown= nobody:nogroup
username = user
password = 123
```

## Настройки раздела `[inet_http_server]`

Файл `supervisord.conf` содержит раздел с именем `[inet_http_server]`, в котором должны быть вставлены параметры конфигурации для HTTP-сервера, который прослушивает сокет TCP (интернет). Если в конфигурационном файле нет раздела `[inet_http_server]`, HTTP-сервер inet не будет запущен. Допустимые значения конфигурации следующие.

{% hint style="warning" %}
HTTP-сервер inet не включен по умолчанию. Если вы решите включить его, прочтите следующее предупреждение о безопасности. HTTP-сервер inet предназначен для использования только в доверенной среде. Он должен быть привязан только к локальному хосту или доступен только из изолированной доверенной сети. HTTP-сервер inet не поддерживает никакие формы шифрования. HTTP-сервер inet по умолчанию не использует аутентификацию (см. параметры **username=** и **password=**). HTTP-сервером inet можно управлять удаленно из **supervisorctl**. Он также обслуживает веб-интерфейс, который позволяет запускать или останавливать подпроцессы и просматривать журналы подпроцессов. **Никогда не выставляйте HTTP-сервер inet в общедоступный Интернет.**
{% endhint %}

### Секция значений `[inet_http_server]`

**`port`**

Значение TCP **host:port** или (например, `127.0.0.1:9001`), на котором супервизор будет прослушивать запросы **HTTP/XML-RPC**. **supervisorctl** будет использовать XML-RPC для связи с **supervisord** через этот порт. Чтобы прослушивать все интерфейсы машины, используйте `:9001` или `*:9001`. Пожалуйста, прочтите предупреждение о безопасности выше.

_По умолчанию_: Нет по умолчанию.

_Требуется_: Да.

_Введено_: 3.0

**`username`**

Имя пользователя, необходимое для аутентификации на этом HTTP-сервере.

_По умолчанию_: Имя пользователя не требуется.

_Требуется_: Нет.

_Введено_: 3.0

**`password`**

Пароль, необходимый для аутентификации на этом HTTP-сервере. Это может быть пароль в открытом виде или указанный в виде хэша **SHA-1**, если перед ним стоит строка `{SHA}`. Например, `{SHA}82ab876d1387bfafe46cc1c8a2ef074eae50cb1d` — это хранящаяся в SHA версия пароля «thepassword».

Обратите внимание, что хешированный пароль должен быть в шестнадцатеричном формате.

_По умолчанию_: Пароль не требуется.

_Требуется_: Нет.

_Введено_: 3.0

### Пример секции `[inet_http_server]`

```ini
[inet_http_server]
port = 127.0.0.1:9001
username = user
password = 123
```

## Настройки раздела `[supervisord]`

Файл `supervisord.conf` содержит раздел с именем `[supervisord]`, в который должны быть вставлены глобальные настройки, относящиеся к процессу **supervisord**. Они заключаются в следующем.

### Секция значений `[supervisord]`

**`logfile`**

Путь к журналу действий процесса **supervisord**. Эта опция может включать значение `%(here)s`, которое расширяется до каталога, в котором был найден файл конфигурации **supervisord**.

{% hint style="info" %}
Если **logfile** задан как специальный файл, такой как `/dev/stdout`, который не доступен для поиска, необходимо отключить ротацию журнала, установив `logfile_maxbytes = 0`.
{% endhint %}

_По умолчанию_: `$CWD/supervisord.log`.

_Требуется_: Нет.

_Введено_: 3.0

**`logfile_maxbyte`**

Максимальное количество байтов, которое может быть использовано файлом журнала активности до его ротации (в значении можно использовать множители суффиксов, такие как «KB», «MB» и «GB»). Установите это значение равным `0`, чтобы указать неограниченный размер журнала.

_По умолчанию_: 50MB

_Требуется_: Нет.

_Введено_: 3.0

**`logfile_backups`**

Количество резервных копий, которые необходимо сохранить в результате ротации файлов журнала активности. Если установлено значение `0`, резервные копии не сохраняются.

_По умолчанию_: 10

_Требуется_: Нет.

_Введено_: 3.0

**`loglevel`**

Уровень ведения журнала, определяющий, что записывается в журнал действий **supervisord**. Одно из **critical**, **error**, **warn**, **info**, **debug**, **trace** или **blather**. Обратите внимание, что при  уровне журнала **debug** файл журнала **supervisord** будет записывать выходные данные `stderr/stdout` своих дочерних процессов и расширенную информацию об изменениях состояния процесса, что полезно для отладки процесса, который не запускается должным образом. См. также: <mark style="color:purple;">Уровни журнала действий</mark>.

_По умолчанию_: **info**

_Требуется_: Нет.

_Введено_: 3.0

**`pidfile`**

Расположение, в котором **supervisord** хранит свой файл **pid**. Эта опция может включать значение `%(here)s`, которое расширяется до каталога, в котором был найден файл конфигурации **supervisord**.

_По умолчанию_: `$CWD/supervisord.pid`

_Требуется_: Нет.

_Введено_: 3.0

**`umask`**

[umask](http://supervisord.org/glossary.html#term-umask) процесса **supervisord**.

_По умолчанию_: `022`

_Требуется_: Нет.

_Введено_: 3.0

**`nodaemon`**

Если `true`, **supervisord** запустится на переднем плане, а не демонизируется.

_По умолчанию_: `false`

_Требуется_: Нет.

_Введено_: 3.0

**`silent`**

Если значение равно `true` и не демонизировано, журналы не будут направляться на стандартный вывод stdout.

_По умолчанию_: `false`

_Требуется_: Нет.

_Введено_: 4.2.0

**`minfds`**

Минимальное количество файловых дескрипторов, которое должно быть доступно для успешного запуска **supervisord**. Будет сделан вызов **setrlimit**, чтобы попытаться поднять мягкие и жесткие ограничения процесса **supervisord**, чтобы удовлетворить **minfds**. Жесткое ограничение может быть увеличено только в том случае, если **supervisord** запущен от имени пользователя **root**. **supervisord** свободно использует файловые дескрипторы и переходит в режим сбоя, когда его нельзя получить из ОС, поэтому полезно иметь возможность указать минимальное значение, чтобы гарантировать, что они не закончатся во время выполнения. Эти ограничения будут унаследованы управляемыми подпроцессами. Этот параметр особенно полезен в **Solaris**, где по умолчанию установлен низкий предел **fd** для каждого процесса.

_По умолчанию_: `1024`

_Требуется_: Нет.

_Введено_: 3.0

**`minprocs`**

Минимальное количество дескрипторов процессов, которое должно быть доступно для успешного запуска **supervisord**. Будет сделан вызов **setrlimit**, чтобы попытаться повысить мягкие и жесткие ограничения процесса **supervisord**, чтобы удовлетворить требования **minprocs**. Жесткое ограничение может быть увеличено только в том случае, если **supervisord** запущен от имени пользователя **root**. **supervisord** перейдет в режим сбоя, когда в ОС закончатся дескрипторы процессов, поэтому полезно убедиться, что при запуске **supervisord** доступно достаточное количество дескрипторов процессов.

_По умолчанию_: `200`

_Требуется_: Нет.

_Введено_: 3.0

**`nocleanup`**

Предотвращает очистку **supervisord** любых существующих дочерних файлов журнала **AUTO** во время запуска. Полезно для отладки.

_По умолчанию_: `false`

_Требуется_: Нет.

_Введено_: 3.0

**`childlogdir`**

Каталог, используемый для дочерних файлов журнала **AUTO**. Эта опция может включать значение `%(here)s`, которое расширяется до каталога, в котором был найден файл конфигурации **supervisord**.

_По умолчанию_: значение Python `tempfile.gettempdir()`

_Требуется_: Нет.

_Введено_: 3.0

**`user`**

Поручает **supervisord** переключить пользователей на эту учетную запись пользователя UNIX, прежде чем выполнять какую-либо значимую обработку. Пользователь может быть переключен только в том случае, если **supervisord** запущен как пользователь **root**.

_По умолчанию_: не переключает пользователей

_Требуется_: Нет.

_Введено_: 3.0

_Изменено_: **3.3.4**. Если **supervisord** не может переключиться на указанного пользователя, он напишет сообщение об ошибке в **stderr** и немедленно завершит работу. В более ранних версиях он продолжал работать, но регистрировал сообщение на критическом уровне.

**`directory`**

Когда **supervisord** демонизируется, то переключается в этот каталог. Эта опция может включать значение `%(here)s`, которое расширяется до каталога, в котором был найден файл конфигурации **supervisord**.

_По умолчанию_: не делает cd

_Требуется_: Нет.

_Введено_: 3.0

**`strip_ansi`**

Удаляет все escape-последовательности ANSI из дочерних файлов журналов.

_По умолчанию_: `false`

_Требуется_: Нет.

_Введено_: 3.0

**`environment`**

Список пар ключ/значение в виде `KEY="val",KEY2="val2"`, которые будут помещены в среду всех дочерних процессов. Это не меняет среду самого **supervisord**. Эта опция может включать значение `%(here)s`, которое расширяется до каталога, в котором был найден файл конфигурации **supervisord**. Значения, содержащие небуквенно-цифровые символы, следует заключать в кавычки (например, `KEY="val:123",KEY2="val,456"`). В противном случае заключать значения в кавычки необязательно, но рекомендуется. Чтобы экранировать символы процента, просто используйте два символа (например, `URI="/first%%20name"`). Обратите внимание, что подпроцессы наследуют переменные среды оболочки, используемые для запуска **supervisord**, за исключением тех, которые переопределены здесь и в параметрах **environment** программы. См. <mark style="color:purple;">Среда подпроцесса</mark>.

_По умолчанию_: нет значения

_Требуется_: Нет.

_Введено_: 3.0

**`identifier`**

Строка идентификатора для этого процесса **supervisord**, используемого интерфейсом RPC.

_По умолчанию_: supervisor

_Требуется_: Нет.

_Введено_: 3.0

### Пример секции `[supervisord]`

```ini
[supervisord]
logfile = /tmp/supervisord.log
logfile_maxbytes = 50MB
logfile_backups=10
loglevel = info
pidfile = /tmp/supervisord.pid
nodaemon = false
minfds = 1024
minprocs = 200
umask = 022
user = chrism
identifier = supervisor
directory = /tmp
nocleanup = true
childlogdir = /tmp
strip_ansi = false
environment = KEY1="value1",KEY2="value2"
```

## Настройки раздела `[supervisorctl]`

Файл конфигурации может содержать настройки интерактивной оболочки **supervisorctl**. Эти параметры перечислены ниже.

### Секция значений `[supervisorctl]`

**`serverurl`**

URL-адрес, который следует использовать для доступа к серверу **supervisord**, например, `http://localhost:9001`. Для сокетов домена UNIX используйте `unix:///absolute/path/to/file.sock`.

_По умолчанию_: `http://localhost:9001`

_Требуется_: Нет.

_Введено_: 3.0

**`username`**

Имя пользователя для передачи на сервер **supervisord** для использования при аутентификации. Это должно совпадать с **username** из конфигурации сервера **supervisord** для порта или сокета домена UNIX, к которому вы пытаетесь получить доступ.

_По умолчанию_: нет username

_Требуется_: Нет.

_Введено_: 3.0

**`password`**

Пароль для передачи на сервер **supervisord** для использования при аутентификации. Это должна быть версия пароля в открытом виде из конфигурации сервера **supervisord** для порта или сокета домена UNIX, к которому вы пытаетесь получить доступ. Это значение _**нельзя**_ передавать в виде хэша SHA. В отличие от других паролей, указанных в этом файле, он должен быть предоставлен в открытом виде.

_По умолчанию_: нет password

_Требуется_: Нет.

_Введено_: 3.0

**`prompt`**

Строка, используемая в качестве приглашения **supervisorctl**.

_По умолчанию_: `supervisor`

_Требуется_: Нет.

_Введено_: 3.0

**`history_file`**

Путь для использования в качестве файла постоянной истории **readline**. Если вы включите эту функцию, выбрав путь, ваши команды **supervisorctl** будут храниться в файле, и вы сможете использовать строку чтения (например, стрелку вверх) для вызова команд, которые вы выполняли в своем последнем сеансе **supervisorctl**.

_По умолчанию_: нет файла

_Требуется_: Нет.

_Введено_: 3.0a5

### Пример секции `[supervisorctl]`

```ini
[supervisorctl]
serverurl = unix:///tmp/supervisor.sock
username = chris
password = 123
prompt = mysupervisor
```

## Настройки раздела `[program:x]`

## Настройки раздела `[include]`

## Настройки раздела `[group:x]`

## Настройки раздела `[fcgi-program:x]`

## Настройки раздела `[eventlistener:x]`

## Настройки раздела `[rpcinterface:x]`
