# Обновление Supervisor 2 до 3

При обновлении установки с Supervisor 2.X до Supervisor 3.X верно следующее:

1. В секциях `[program:x]` ключи **logfile**, **logfile\_backups**, **logfile\_maxbytes**, **log\_stderr** и **log\_stdout** больше недействительны. Supervisor2 записывает логи как **stderr**, так и **stdout** в один файл журнала. Supervisor 3 записывает **stderr** и **stdout** в отдельные файлы журналов. Вам нужно будет переименовать **logfile** в **stdout\_logfile**, **logfile\_backups** в **stdout\_logfile\_backups** и **logfile\_maxbytes** в **stdout\_logfile\_maxbytes**, по крайней мере, чтобы сохранить вашу конфигурацию. Если вы создали разделы программы, в которых значение **log\_stderr** равно `true`, чтобы сохранить поведение отправки вывода **stderr** в журнал **stdout**, вместо этого используйте логическое значение **redirect\_stderr** в разделе программы.
2.  Файл конфигурации супервизора должен дословно включать следующий раздел для правильной работы интерфейса XML-RPC (и, следовательно, веб-интерфейса и **supervisorctl**):&#x20;

    ```ini
    [rpcinterface:supervisor]
    supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
    ```
3. Изменилась семантика параметра **autorestart** в секциях `[program:x]`. Этот параметр раньше принимал только `true` или `false`. Теперь он принимает дополнительное значение, **unexpected**, которое указывает, что процесс должен перезапуститься из состояния **EXITED** только в том случае, если его код выхода **exitcode** не соответствует ни одному из кодов, представленных параметром кода выхода в конфигурации процесса (подразумевая сбой процесса). Кроме того, значение по умолчанию для автоматического перезапуска **autorestart** теперь является **unexpected** (раньше оно было `true`, что означало безоговорочный перезапуск).
4. Теперь мы разрешаем **supervisord** прослушивать как сокет домена UNIX, так и сокет inet вместо того, чтобы делать прослушивание одного взаимоисключающим с прослушиванием другого. В результате параметры **http\_port**, **http\_username**, **http\_password**, **sockchmod** и **sockchown** больше не являются частью конфигурации раздела `[supervisord]`. Они были заменены двумя другими разделами: `[unix_http_server]` и `[inet_http_server]`. Вам нужно будет вставить один или другой (в зависимости от того, хотите ли вы прослушивать сокет домена UNIX или сокет TCP соответственно) или оба в ваш файл `supervisord.conf`. Эти разделы имеют свои собственные параметры (где применимо) для **port**, **username**, **password**, **chmod** и **chown**.
5. Все параметры командной строки **supervisord**, связанные с **http\_port**, **http\_username**, **http\_password**, **sockchmod** и **sockchown**, были удалены (обоснование см. выше).
6. Параметр, который раньше был **sockchown** в разделе `[supervisord]` (и теперь называется **chown** в разделе `[unix_http_server]`), раньше принимал значение, разделенное точками (**user.group**). Разделителем теперь должно быть двоеточие, например, **user:group**. Unices позволяет использовать точки в именах пользователей, поэтому это изменение является исправлением ошибки.
