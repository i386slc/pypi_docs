# Настройка gunicorn

Это исчерпывающий список настроек для **Gunicorn**. Некоторые настройки можно установить только из файла конфигурации. Имя параметра — это то, что следует использовать в файле конфигурации. Аргументы командной строки также перечислены для справки по настройке в командной строке.

{% hint style="info" %}
Настройки можно указать с помощью переменной среды **GUNICORN\_CMD\_ARGS**. Можно использовать все доступные аргументы командной строки. Например, чтобы указать адрес привязки и количество воркеров:

```bash
$ GUNICORN_CMD_ARGS="--bind=127.0.0.1 --workers=3" gunicorn app:app
```

_Новое в версии 19.7_.
{% endhint %}

## Файл конфигурации

### config

**Командная строка**: `-c CONFIG` или `--config CONFIG`

**По умолчанию**: `'./gunicorn.conf.py'`

Конфигурационный файл **Gunicorn**.

Строка вида `PATH`, `file:PATH` или `python:MODULE_NAME`.

Имеет эффект только в том случае, если указан в командной строке или как часть конфигурации конкретного приложения.

По умолчанию файл с именем **gunicorn.conf.py** будет считываться из того же каталога, где запускается **gunicorn**.

_Изменено в версии 19.4_: для загрузки конфигурации из модуля Python требуется префикс `python:`.

### wsgi\_app

**По умолчанию**: `None`

Путь к приложению WSGI в шаблоне `$(MODULE_NAME):$(VARIABLE_NAME)`.

_Новое в версии 20.1.0_.

## Отладка

### reload

**Командная строка**: `--reload`

**По умолчанию**: `False`

Перезапуск воркеров при изменении кода.

Эта настройка предназначена для разработки. Это приведет к перезапуску рабочих процессов при каждом изменении кода приложения.

**Reloader** несовместим с предварительной загрузкой приложений. При использовании конфигурации вставки **paste** убедитесь, что блок сервера не импортирует код приложения, иначе перезагрузка не будет работать должным образом.

Поведение по умолчанию — попытка **inotify** с откатом к опросу файловой системы. Как правило, следует предпочесть **inotify**, если он доступен, поскольку он потребляет меньше системных ресурсов.

{% hint style="info" %}
Чтобы использовать загрузчик **inotify**, у вас должен быть установлен пакет **inotify**.
{% endhint %}

### reload\_engine

**Командная строка**: `--reload-engine STRING`

**По умолчанию**: `'auto'`

Реализация, которая должна использоваться для сильной [reload](nastroika-gunicorn.md#reload).

Действительные движки engine:

* `'auto'`
* `'poll'`
* `'inotify'` (требуется **inotify**)

_Новое в версии 19.7_.

### reload\_extra\_files

**Командная строка**: `--reload-extra-file FILES`

**По умолчанию**: `[]`

Расширяет возможность перезагрузки, чтобы также просматривать и [перезагружать](nastroika-gunicorn.md#reload) дополнительные файлы (например, шаблоны, конфигурации, спецификации и т. д.).

_Новое в версии 19.8_.

### spew

**Командная строка**: `--spew`

**По умолчанию**: `False`

Устанавливает функцию трассировки, которая извергает каждую строку, выполняемую сервером.

Это ядерный вариант.

### check\_config

**Командная строка**: `--check-config`

**По умолчанию**: `False`

Проверяет конфигурацию и выходит. Статус выхода равен `0`, если конфигурация правильная, и `1`, если конфигурация неверна.

### print\_config

**Командная строка**: `--print-config`

**По умолчанию**: `False`

Распечатывает параметры конфигурации как полностью разрешенные. Подразумевает [check\_config](nastroika-gunicorn.md#check\_config).

## Логирование

### accesslog

**Командная строка**: `--access-logfile FILES`

**По умолчанию**: `False`

Файл журнала доступа для записи.

`'-'` означает логирование на стандартный вывод.

### disable\_redirect\_access\_to\_syslog

**Командная строка**: `--disable-redirect-access-to-syslog`

**По умолчанию**: `False`

Отключает перенаправление журналов доступа к системному журналу.

_Новое в версии 19.8_.

### access\_log\_format

**Командная строка**: `--access-logformat STRING`

**По умолчанию**: `'%(h)s %(l)s %(u)s %(t)s "%(r)s" %(s)s %(b)s "%(f)s" "%(a)s"'`

Формат журнала доступа.

| Идентификатор | Описание                                    |
| ------------- | ------------------------------------------- |
| h             | удаленный адрес                             |
| l             | `'-'`                                       |
| u             | имя пользователя                            |
| t             | дата запроса                                |
| r             | строка статуса (например, `GET / HTTP/1.1`) |
| m             | метод запроса                               |
| U             | путь URL без строки запроса                 |
| q             | строка запроса                              |
| H             | протокол                                    |
| s             | статус                                      |
| B             | длина ответа                                |
| b             | длина ответа или `'-'` (формат CLF)         |
| f             | реферер                                     |
| a             | агент пользователя                          |
| T             | время запроса в секундах                    |
| M             | время запроса в миллисекундах               |
| D             | время запроса в микросекундах               |
| L             | время запроса в десятичных секундах         |
| p             | ID процесса                                 |
| `{header}i`   | заголовок запроса                           |
| `{header}o`   | заголовок ответа                            |
| `{variable}e` | переменная окружения                        |

Используйте строчные буквы для имен заголовков и переменных среды и поместите имена `{...}x` внутри `%(...)s`. Например:

```python
%({x-forwarded-for}i)s
```

### errorlog

**Командная строка**: `--error-logfile FILE` или `--log-file FILE`

**По умолчанию**: `'-'`

Файл журнала ошибок для записи.

Использование `'-'` для **FILE** приводит к тому, что файл **gunicorn** записывается в **stderr**.

_Изменено в версии 19.2_: логирование в **stderr** по умолчанию.

### loglevel

**Командная строка**: `--log-level LEVEL`

**По умолчанию**: `'info'`

Степень детализации выходных данных журнала ошибок.

Допустимые названия уровней:

* `'debug'`
* `'info'`
* `'warning'`
* `'error'`
* `'critical'`

### capture\_output

**Командная строка**: `--capture-output`

**По умолчанию**: `False`

Перенаправить **stdout/stderr** в указанный файл в журнале ошибок.

_Новое в версии 19.6_.

### logger\_class

**Командная строка**: `--logger-class STRING`

**По умолчанию**: `'gunicorn.glogging.Logger'`

Регистратор, который вы хотите использовать для регистрации событий в **Gunicorn**.

Класс по умолчанию (`gunicorn.glogging.Logger`) обрабатывает большинство обычных способов ведения журнала. Он обеспечивает регистрацию ошибок и доступа.

Вы можете предоставить свой собственный регистратор, предоставив **Gunicorn** путь Python к классу, который "крякает" как `gunicorn.glogging.Logger`.

### logconfig

**Командная строка**: `--log-config FILE`

**По умолчанию**: `None`

Используемый файл конфигурации журнала. **Gunicorn** использует стандартный формат файла конфигурации модуля ведения журнала Python.

### logconfig\_dict

**По умолчанию**: `{}`

Используемый словарь конфигурации журнала с использованием стандартного формата конфигурации словаря модуля ведения журнала Python. Этот параметр имеет приоритет над параметром [logconfig](nastroika-gunicorn.md#logconfig), который использует старый формат конфигурации файла.

Формат:[ https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig](https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig)

_Новое в версии 19.8_.

### syslog\_addr

**Командная строка**: `--log-syslog-to SYSLOG_ADDR`

**По умолчанию**: `'udp://localhost:514'`

Адрес для отправки сообщений системного журнала.

Адрес представляет собой строку вида:

* `unix://PATH#TYPE` : для сокета домена unix. **TYPE** может быть **stream** для потокового драйвера или **dgram** для драйвера **dgram**. **stream** по умолчанию.
* `udp://HOST:PORT` : для сокетов **UDP**
* `tcp://HOST:PORT` : для сокетов **TCP**

### syslog

**Командная строка**: `--log-syslog`

**По умолчанию**: `False`

Отправляет логи **Gunicorn** в **syslog**.

_Изменено в версии 19.8_: теперь вы можете отключить отправку журналов доступа с помощью параметра [disable\_redirect\_access\_to\_syslog](nastroika-gunicorn.md#disable\_redirect\_access\_to\_syslog).

### syslog\_prefix

**Командная строка**: `--log-syslog-prefix SYSLOG_PREFIX`

**По умолчанию**: `None`

Заставляет **Gunicorn** использовать параметр как имя программы в записях системного журнала.

Все записи будут иметь префикс `gunicorn.<prefix>`. По умолчанию именем программы является имя процесса.

### syslog\_facility

**Командная строка**: `--log-syslog-facility SYSLOG_FACILITY`

**По умолчанию**: `'user'`

Имя средства системного журнала

## Именование процессов

## SSL

## Безопасность

## Серверные хуки

## Механика сервера

## Сокет сервера

## Процессы воркера
