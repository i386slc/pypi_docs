# Запуск gunicorn

Вы можете запустить **Gunicorn** с помощью команд или интегрироваться с популярными платформами, такими как **Django**, **Pyramid** или **TurboGears**. Для развертывания **Gunicorn** в рабочей среде см. [Развертывание Gunicorn](razvertyvanie-gunicorn.md).

## Команды

После установки **Gunicorn** у вас будет доступ к скрипту командной строки **gunicorn**.

### gunicorn

Базовое применение:

```bash
$ gunicorn [OPTIONS] [WSGI_APP]
```

Где **WSGI\_APP** имеет шаблон `$(MODULE_NAME):$(VARIABLE_NAME)`. Имя модуля может быть полным точечным путем. Имя переменной относится к вызываемому объекту **WSGI**, который должен быть найден в указанном модуле.

_Изменено в версии 20.1.0_: **WSGI\_APP** является необязательным, если он определен в [файле конфигурации](nastroika-gunicorn.md).

Пример с тестовым приложением:

```python
def app(environ, start_response):
    """Самый простой объект приложения"""
    data = b'Hello, World!\n'
    status = '200 OK'
    response_headers = [
        ('Content-type', 'text/plain'),
        ('Content-Length', str(len(data)))
    ]
    start_response(status, response_headers)
    return iter([data])
```

Теперь вы можете запустить приложение с помощью следующей команды:

```bash
$ gunicorn --workers=2 test:app
```

Имя переменной также может быть вызовом функции. В этом случае имя будет импортировано из модуля, а затем вызвано для получения объекта приложения. Это обычно называют шаблоном «фабрика приложений».

```python
def create_app():
    app = FrameworkApp()
    ...
    return app
```

```bash
$ gunicorn --workers=2 'test:create_app()'
```

Также можно передавать позиционные и ключевые аргументы, но рекомендуется загружать конфигурацию из переменных среды, а не из командной строки.

### Часто используемые аргументы

* **-c CONFIG, --config=CONFIG** — укажите файл конфигурации в форме `$(PATH)`, `file:$(PATH)` или `python:$(MODULE_NAME)`.
* **-b BIND, --bind=BIND** — указать серверный сокет для привязки. Сокеты сервера могут быть любыми из `$(HOST)`, `$(HOST):$(PORT)`, `fd://$(FD)` или `unix:$(PATH)`. IP-адрес является действительным `$(HOST)`.
* **-w WORKERS, --workers=WORKERS** - Количество рабочих процессов. Обычно это число должно составлять от 2 до 4 рабочих на ядро сервера. Проверьте [ответы на часто задаваемые вопросы](voprosy-otvety-gunicorn.md), чтобы узнать, как настроить этот параметр.
* **-k WORKERCLASS, --worker-class=WORKERCLASS** — Тип рабочего процесса для запуска. Вы определенно захотите прочитать производственную страницу о последствиях этого параметра. Вы можете установить это значение в `$(NAME)`, где `$(NAME)` — это **sync**, **eventlet**, **gevent**, **tornado**, **gthread**. **sync** установлен по умолчанию. См. документацию [worker\_class](nastroika-gunicorn.md) для получения дополнительной информации.
* **-n APP\_NAME, --name=APP\_NAME** — если установлен [setproctitle](https://pypi.python.org/pypi/setproctitle), вы можете настроить имя процесса **Gunicorn**, как оно отображается в системной таблице процессов (что влияет на такие инструменты, как **ps** и **top**).

Настройки можно указать с помощью переменной среды [GUNICORN\_CMD\_ARGS](https://docs.gunicorn.org/en/stable/settings.html#settings).

Подробное описание использования см. в разделе [Обзор конфигурации](obzor-konfiguracii-gunicorn.md) и [настройки](nastroika-gunicorn.md).

## Интеграция

**Gunicorn** также обеспечивает интеграцию с приложениями **Django** и **Paste Deploy**.

### Django

**Gunicorn** будет искать вызываемое **WSGI** именованное приложение **application**, если оно не указано. Таким образом, для типичного проекта **Django** вызов **Gunicorn** будет выглядеть так:

```bash
$ gunicorn myproject.wsgi
```

{% hint style="info" %}
Это требует, чтобы ваш проект находился на пути Python; самый простой способ убедиться в этом — запустить эту команду из того же каталога, что и ваш файл **manage.py**.
{% endhint %}

Вы можете использовать параметр [–env](nastroika-gunicorn.md), чтобы указать путь для загрузки настроек. Если вам это нужно, вы также можете добавить путь к вашему приложению в **PYTHONPATH**, используя параметр [–pythonpath](nastroika-gunicorn.md):

```bash
$ gunicorn --env DJANGO_SETTINGS_MODULE=myproject.settings myproject.wsgi
```

### Paste Deployment

Такие платформы, как **Pyramid** и **Turbogears**, обычно настраиваются с использованием файлов конфигурации **Paste Deployment**. Если вы хотите использовать эти файлы с **Gunicorn**, есть два подхода.

Как средство запуска сервера, **Gunicorn** может обслуживать ваше приложение, используя команды из вашего фреймворка, такие как **pserve** или **gear**. Чтобы использовать **Gunicorn** с этими командами, укажите его в качестве сервера в файле конфигурации:

```bash
[server:main]
use = egg:gunicorn#main
host = 127.0.0.1
port = 8080
workers = 3
```

Этот подход — самый быстрый способ начать работу с **Gunicorn**, но есть некоторые ограничения. **Gunicorn** не будет контролировать загрузку приложения, поэтому такие настройки, как [reload](nastroika-gunicorn.md), не будут иметь никакого значения, и **Gunicorn** не сможет выполнить горячее обновление работающего приложения. Использование опции [daemon](nastroika-gunicorn.md) может запутать ваш инструмент командной строки. Вместо этого используйте встроенную поддержку этих функций, предоставляемую этим инструментом. Например, запустите `pserve --reload` вместо указания `reload = True` в блоке конфигурации сервера. Для расширенной настройки **Gunicorn**, такой как [Server Hooks](nastroika-gunicorn.md), поддерживается указание файла конфигурации **Gunicorn** с использованием ключа **config**.

Чтобы использовать всю мощь перезагрузки **Gunicorn** и обновлений горячего кода, вместо этого используйте опцию [paste option](nastroika-gunicorn.md) для запуска вашего приложения. При таком использовании **Gunicorn** будет использовать приложение, определенное в файле конфигурации **PasteDeploy**, но **Gunicorn** не будет использовать какую-либо конфигурацию сервера, определенную в файле. Вместо этого настройте [конфигурацию gunicorn](obzor-konfiguracii-gunicorn.md).

Например:

```bash
$ gunicorn --paste development.ini -b :8080 --chdir /path/to/project
```

Или используйте другое приложение:

```bash
$ gunicorn --paste development.ini#admin -b :8080 --chdir /path/to/project
```

При обоих подходах **Gunicorn** будет использовать любой раздел регистраторов, найденный в файле конфигурации Paste Deployment, если не указано иное, указав дополнительные [параметры ведения журнала](nastroika-gunicorn.md).
