# Настройка gunicorn

Это исчерпывающий список настроек для **Gunicorn**. Некоторые настройки можно установить только из файла конфигурации. Имя параметра — это то, что следует использовать в файле конфигурации. Аргументы командной строки также перечислены для справки по настройке в командной строке.

{% hint style="info" %}
Настройки можно указать с помощью переменной среды **GUNICORN\_CMD\_ARGS**. Можно использовать все доступные аргументы командной строки. Например, чтобы указать адрес привязки и количество воркеров:

```bash
$ GUNICORN_CMD_ARGS="--bind=127.0.0.1 --workers=3" gunicorn app:app
```

_Новое в версии 19.7_.
{% endhint %}

## Файл конфигурации

### config

**Командная строка**: `-c CONFIG` или `--config CONFIG`

**По умолчанию**: `'./gunicorn.conf.py'`

Конфигурационный файл **Gunicorn**.

Строка вида `PATH`, `file:PATH` или `python:MODULE_NAME`.

Имеет эффект только в том случае, если указан в командной строке или как часть конфигурации конкретного приложения.

По умолчанию файл с именем **gunicorn.conf.py** будет считываться из того же каталога, где запускается **gunicorn**.

_Изменено в версии 19.4_: для загрузки конфигурации из модуля Python требуется префикс `python:`.

### wsgi\_app

**По умолчанию**: `None`

Путь к приложению WSGI в шаблоне `$(MODULE_NAME):$(VARIABLE_NAME)`.

_Новое в версии 20.1.0_.

## Отладка

### reload

**Командная строка**: `--reload`

**По умолчанию**: `False`

Перезапуск воркеров при изменении кода.

Эта настройка предназначена для разработки. Это приведет к перезапуску рабочих процессов при каждом изменении кода приложения.

**Reloader** несовместим с предварительной загрузкой приложений. При использовании конфигурации вставки **paste** убедитесь, что блок сервера не импортирует код приложения, иначе перезагрузка не будет работать должным образом.

Поведение по умолчанию — попытка **inotify** с откатом к опросу файловой системы. Как правило, следует предпочесть **inotify**, если он доступен, поскольку он потребляет меньше системных ресурсов.

{% hint style="info" %}
Чтобы использовать загрузчик **inotify**, у вас должен быть установлен пакет **inotify**.
{% endhint %}

### reload\_engine

**Командная строка**: `--reload-engine STRING`

**По умолчанию**: `'auto'`

Реализация, которая должна использоваться для сильной [reload](nastroika-gunicorn.md#reload).

Действительные движки engine:

* `'auto'`
* `'poll'`
* `'inotify'` (требуется **inotify**)

_Новое в версии 19.7_.

### reload\_extra\_files

**Командная строка**: `--reload-extra-file FILES`

**По умолчанию**: `[]`

Расширяет возможность перезагрузки, чтобы также просматривать и [перезагружать](nastroika-gunicorn.md#reload) дополнительные файлы (например, шаблоны, конфигурации, спецификации и т. д.).

_Новое в версии 19.8_.

### spew

**Командная строка**: `--spew`

**По умолчанию**: `False`

Устанавливает функцию трассировки, которая извергает каждую строку, выполняемую сервером.

Это ядерный вариант.

### check\_config

**Командная строка**: `--check-config`

**По умолчанию**: `False`

Проверяет конфигурацию и выходит. Статус выхода равен `0`, если конфигурация правильная, и `1`, если конфигурация неверна.

### print\_config

**Командная строка**: `--print-config`

**По умолчанию**: `False`

Распечатывает параметры конфигурации как полностью разрешенные. Подразумевает [check\_config](nastroika-gunicorn.md#check\_config).

## Логирование

### accesslog

**Командная строка**: `--access-logfile FILES`

**По умолчанию**: `False`

Файл журнала доступа для записи.

`'-'` означает логирование на стандартный вывод.

### disable\_redirect\_access\_to\_syslog

**Командная строка**: `--disable-redirect-access-to-syslog`

**По умолчанию**: `False`

Отключает перенаправление журналов доступа к системному журналу.

_Новое в версии 19.8_.

### access\_log\_format

**Командная строка**: `--access-logformat STRING`

**По умолчанию**: `'%(h)s %(l)s %(u)s %(t)s "%(r)s" %(s)s %(b)s "%(f)s" "%(a)s"'`

Формат журнала доступа.

<table><thead><tr><th width="262">Идентификатор</th><th>Описание</th></tr></thead><tbody><tr><td>h</td><td>удаленный адрес</td></tr><tr><td>l</td><td><code>'-'</code></td></tr><tr><td>u</td><td>имя пользователя</td></tr><tr><td>t</td><td>дата запроса</td></tr><tr><td>r</td><td>строка статуса (например, <code>GET / HTTP/1.1</code>)</td></tr><tr><td>m</td><td>метод запроса</td></tr><tr><td>U</td><td>путь URL без строки запроса</td></tr><tr><td>q</td><td>строка запроса</td></tr><tr><td>H</td><td>протокол</td></tr><tr><td>s</td><td>статус</td></tr><tr><td>B</td><td>длина ответа</td></tr><tr><td>b</td><td>длина ответа или <code>'-'</code> (формат CLF)</td></tr><tr><td>f</td><td>реферер</td></tr><tr><td>a</td><td>агент пользователя</td></tr><tr><td>T</td><td>время запроса в секундах</td></tr><tr><td>M</td><td>время запроса в миллисекундах</td></tr><tr><td>D</td><td>время запроса в микросекундах</td></tr><tr><td>L</td><td>время запроса в десятичных секундах</td></tr><tr><td>p</td><td>ID процесса</td></tr><tr><td><code>{header}i</code></td><td>заголовок запроса</td></tr><tr><td><code>{header}o</code></td><td>заголовок ответа</td></tr><tr><td><code>{variable}e</code></td><td>переменная окружения</td></tr></tbody></table>

Используйте строчные буквы для имен заголовков и переменных среды и поместите имена `{...}x` внутри `%(...)s`. Например:

```python
%({x-forwarded-for}i)s
```

### errorlog

**Командная строка**: `--error-logfile FILE` или `--log-file FILE`

**По умолчанию**: `'-'`

Файл журнала ошибок для записи.

Использование `'-'` для **FILE** приводит к тому, что файл **gunicorn** записывается в **stderr**.

_Изменено в версии 19.2_: логирование в **stderr** по умолчанию.

### loglevel

**Командная строка**: `--log-level LEVEL`

**По умолчанию**: `'info'`

Степень детализации выходных данных журнала ошибок.

Допустимые названия уровней:

* `'debug'`
* `'info'`
* `'warning'`
* `'error'`
* `'critical'`

### capture\_output

**Командная строка**: `--capture-output`

**По умолчанию**: `False`

Перенаправить **stdout/stderr** в указанный файл в журнале ошибок.

_Новое в версии 19.6_.

### logger\_class

**Командная строка**: `--logger-class STRING`

**По умолчанию**: `'gunicorn.glogging.Logger'`

Регистратор, который вы хотите использовать для регистрации событий в **Gunicorn**.

Класс по умолчанию (`gunicorn.glogging.Logger`) обрабатывает большинство обычных способов ведения журнала. Он обеспечивает регистрацию ошибок и доступа.

Вы можете предоставить свой собственный регистратор, предоставив **Gunicorn** путь Python к классу, который "крякает" как `gunicorn.glogging.Logger`.

### logconfig

**Командная строка**: `--log-config FILE`

**По умолчанию**: `None`

Используемый файл конфигурации журнала. **Gunicorn** использует стандартный формат файла конфигурации модуля ведения журнала Python.

### logconfig\_dict

**По умолчанию**: `{}`

Используемый словарь конфигурации журнала с использованием стандартного формата конфигурации словаря модуля ведения журнала Python. Этот параметр имеет приоритет над параметром [logconfig](nastroika-gunicorn.md#logconfig), который использует старый формат конфигурации файла.

Формат:[ https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig](https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig)

_Новое в версии 19.8_.

### syslog\_addr

**Командная строка**: `--log-syslog-to SYSLOG_ADDR`

**По умолчанию**: `'udp://localhost:514'`

Адрес для отправки сообщений системного журнала.

Адрес представляет собой строку вида:

* `unix://PATH#TYPE` : для сокета домена unix. **TYPE** может быть **stream** для потокового драйвера или **dgram** для драйвера **dgram**. **stream** по умолчанию.
* `udp://HOST:PORT` : для сокетов **UDP**
* `tcp://HOST:PORT` : для сокетов **TCP**

### syslog

**Командная строка**: `--log-syslog`

**По умолчанию**: `False`

Отправляет логи **Gunicorn** в **syslog**.

_Изменено в версии 19.8_: теперь вы можете отключить отправку журналов доступа с помощью параметра [disable\_redirect\_access\_to\_syslog](nastroika-gunicorn.md#disable\_redirect\_access\_to\_syslog).

### syslog\_prefix

**Командная строка**: `--log-syslog-prefix SYSLOG_PREFIX`

**По умолчанию**: `None`

Заставляет **Gunicorn** использовать параметр как имя программы в записях системного журнала.

Все записи будут иметь префикс `gunicorn.<prefix>`. По умолчанию именем программы является имя процесса.

### syslog\_facility

**Командная строка**: `--log-syslog-facility SYSLOG_FACILITY`

**По умолчанию**: `'user'`

Имя средства системного журнала

### enable\_stdio\_inheritance

**Командная строка**: `-R` или `--enable-stdio-inheritance`

**По умолчанию**: `False`

Включить наследование **stdio**.

Включить наследование файловых дескрипторов **stdio** в режиме демона.

{% hint style="info" %}
Чтобы отключить буферизацию **stdout** Python, вы можете установить переменную пользовательской среды **PYTHONUNBUFFERED**.
{% endhint %}

### statsd\_host

**Командная строка**: `--statsd-host STATSD_ADDR`

**По умолчанию**: `None`

`host:port` сервера **statsd** для входа.

_Новое в версии 19.1_.

### dogstatsd\_tags

**Командная строка**: `--dogstatsd-tags DOGSTATSD_TAGS`

**По умолчанию**: `''`

Разделенный запятыми список тегов **datadog statsd (dogstatsd)** для добавления к метрикам **statsd**.

_Новое в версии 20_.

### statsd\_prefix

**Командная строка**: `--statsd-prefix STATSD_PREFIX`

**По умолчанию**: `''`

Префикс для использования при выводе показателей **statsd** (добавляется завершающий `.`, если он не указан).

_Новое в версии 19.2_.

## Именование процессов

### proc\_name

**Командная строка**: `-n STRING` или `--name STRING`

**По умолчанию**: `None`

База для использования с **setproctitle** для именования процессов.

Это влияет на такие вещи, как **ps** и **top**. Если вы собираетесь запускать более одного экземпляра **Gunicorn**, вам, вероятно, потребуется установить имя, чтобы отличать их друг от друга. Для этого необходимо установить модуль **setproctitle**.

Если не задано, будет использоваться параметр **default\_proc\_name**.

### default\_proc\_name

**По умолчанию**: `'gunicorn'`.

Внутренняя настройка, которая настраивается для каждого типа приложения.

## SSL

### keyfile

**Командная строка**: `--keyfile FILE`

**По умолчанию**: `None`

Файл ключа SSL

### certifile

**Командная строка**: `--certfile FILE`

**По умолчанию**: `None`

Файл SSL-сертификата

### ssl\_version

**Командная строка**: `--ssl-version`

**По умолчанию**: `<_SSLMethod.PROTOCOL_TLS: 2>`

Версия SSL для использования.

<table><thead><tr><th width="170">--ssl-version</th><th>Описание</th></tr></thead><tbody><tr><td>SSLv3</td><td>SSLv3 не является безопасным и настоятельно не рекомендуется.</td></tr><tr><td>SSLv23</td><td>Псевдоним для TLS. Устарело в Python 3.6, используйте TLS.</td></tr><tr><td>TLS</td><td>Согласуйте максимально возможную версию между клиентом и сервером. Может дать SSL. (Python 3.6+)</td></tr><tr><td>TLSv1</td><td>TLS 1.0</td></tr><tr><td>TLSv1_1</td><td>TLS 1.1 (Python 3.4+)</td></tr><tr><td>TLSv1_2</td><td>TLS 1.2 (Python 3.4+)</td></tr><tr><td>TLS_SERVER</td><td>Автоматическое согласование самой высокой версии протокола, такой как TLS, но поддержка только соединений SSLSocket на стороне сервера. (Python 3.6+)</td></tr></tbody></table>

_Изменено в версии 19.7_: значение по умолчанию изменено с **ssl.PROTOCOL\_TLSv1** на **ssl.PROTOCOL\_SSLv23**.

_Изменено в версии 20.0_: этот параметр теперь принимает строковые имена на основе констант **ssl.PROTOCOL\_**.

### cert\_reqs

**Командная строка**: `--cert-reqs`

**По умолчанию**: `<VerifyMode.CERT_NONE: 0>`

Требуется ли сертификат клиента (см. модуль **stdlib ssl**)

### ca\_certs

**Командная строка**: `--ca-certs FILE`

**По умолчанию**: `None`

Файл сертификатов **CA**

### suppress\_ragged\_eofs

**Командная строка**: `--suppress-ragged-eofs`

**По умолчанию**: `True`

Подавление рваных EOF (см. модуль stdlib ssl)

### do\_handshake\_on\_connect

**Командная строка**: `--do-handshake-on-connect`

**По умолчанию**: `False`

Следует ли выполнять подтверждение SSL при подключении к сокету (см. модуль stdlib ssl)

### ciphers

**Командная строка**: `--ciphers`

**По умолчанию**: `None`

Набор шифров SSL для использования в формате списка шифров OpenSSL.

По умолчанию мы используем список шифров по умолчанию из модуля Python ssl, который содержит шифры, считающиеся надежными на момент выпуска каждого выпуска Python.

В качестве рекомендуемой альтернативы Open Web App Security Project (**OWASP**) предлагает [проверенный набор надежных строк шифрования с рейтингом от A+ до C-](https://www.owasp.org/index.php/TLS\_Cipher\_String\_Cheat\_Sheet). **OWASP** предоставляет подробную информацию о совместимости агента пользователя на каждом уровне безопасности.

Подробнее о формате списка шифров OpenSSL см. в [документации по формату списка шифров OpenSSL](https://www.openssl.org/docs/manmaster/man1/ciphers.html#CIPHER-LIST-FORMAT).

## Безопасность

### limit\_request\_line

**Командная строка**: `--limit-request-line INT`

**По умолчанию**: `4094`

Максимальный размер строки HTTP-запроса в байтах.

Этот параметр используется для ограничения допустимого размера строки HTTP-запроса клиента. Поскольку строка запроса состоит из метода HTTP, URI и версии протокола, эта директива накладывает ограничение на длину URL-адреса запроса, разрешенного для запроса на сервере. Серверу необходимо, чтобы это значение было достаточно большим, чтобы вместить любые имена его ресурсов, включая любую информацию, которая может быть передана в части запроса GET-запроса. Значение представляет собой число от `0` (неограниченно) до `8190`.

Этот параметр можно использовать для предотвращения любой DDOS-атаки.

### limit\_request\_fields

**Командная строка**: `--limit-request-fields INT`

**По умолчанию**: `100`

Ограничьте количество полей заголовков HTTP в запросе.

Этот параметр используется для ограничения количества заголовков в запросе для предотвращения DDOS-атаки. При использовании с **limit\_request\_field\_size** это обеспечивает большую безопасность. По умолчанию это значение равно `100` и не может быть больше `32768`.

### limit\_request\_field\_size

**Командная строка**: `--limit-request-field_size INT`

**По умолчанию**: `8190`

Ограничьте допустимый размер поля заголовка HTTP-запроса.

Значение — положительное число или `0`. Установка его на `0` позволит неограниченные размеры полей заголовка.

{% hint style="warning" %}
Установка для этого параметра очень высокого или неограниченного значения может открыть доступ для DDOS-атак.
{% endhint %}

## Серверные хуки

### on\_starting

**По умолчанию**:

```python
def on_starting(server):
    pass
```

Вызывается непосредственно перед инициализацией основного процесса.

Вызываемый объект должен принимать одну переменную экземпляра для **Arbiter**.

### on\_reload

**По умолчанию**:

```python
def on_reload(server):
    pass
```

Вызывается для перезапуска воркеров во время перезагрузки через **SIGHUP**.

Вызываемый объект должен принимать одну переменную экземпляра для **Arbiter**.

### when\_ready

**По умолчанию**:

```python
def when_ready(server):
    pass
```

Вызывается сразу после запуска сервера.

Вызываемый объект должен принимать одну переменную экземпляра для **Arbiter**.

### pre\_fork

**По умолчанию**:

```python
def pre_fork(server, worker):
    pass
```

Вызывается непосредственно перед разветвлением воркера.

Вызываемый объект должен принимать две переменные экземпляра для **Arbiter** и нового **Worker**.

### post\_fork

**По умолчанию**:

```python
def post_fork(server, worker):
    pass
```

Вызывается непосредственно после ответвления воркера.

Вызываемый объект должен принимать две переменные экземпляра для **Arbiter** и нового **Worker**.

### post\_worker\_init

**По умолчанию**:

```python
def post_worker_init(worker):
    pass
```

Вызывается сразу после того, как процесс воркера инициализирует приложение.

Вызываемый объект должен принимать одну переменную экземпляра для инициализированного **Worker**.

### worker\_int

**По умолчанию**:

```python
def worker_int(worker):
    pass
```

Вызывается сразу после выхода воркера по сигналу **SIGINT** или **SIGQUIT**.

Вызываемый объект должен принимать одну переменную экземпляра для инициализированного **Worker**.

### worker\_abort

**По умолчанию**:

```python
def worker_abort(worker):
    pass
```

Вызывается, когда процесс воркера получает сигнал **SIGABRT**.

Этот вызов обычно происходит по тайм-ауту.

Вызываемый объект должен принимать одну переменную экземпляра для инициализированного **Worker**.

### pre\_exec

**По умолчанию**:

```python
def pre_exec(server):
    pass
```

Вызывается непосредственно перед разветвлением нового главного процесса.

Вызываемый объект должен принимать одну переменную экземпляра для **Arbiter**.

### pre\_request

**По умолчанию**:

```python
def pre_request(worker, req):
    worker.log.debug("%s %s" % (req.method, req.path))
```

Вызывается непосредственно перед обработкой запроса процессом воркера.

Вызываемый объект должен принимать две переменные экземпляра для **Worker** и **Request**.

### post\_request

**По умолчанию**:

```python
def post_request(worker, req, environ, resp):
    pass
```

Вызывается после обработки запроса процессом воркера.

Вызываемый объект должен принимать две переменные экземпляра для **Worker** и **Request**.

### child\_exit

**По умолчанию**:

```python
def child_exit(server, worker):
    pass
```

Вызывается сразу после выхода из процесса воркера в главном процессе.

Вызываемый объект должен принимать две переменные экземпляра для **Arbiter** и только что завершившегося **Worker**.

_Новое в версии 19.7_.

### worker\_exit

**По умолчанию**:

```python
def worker_exit(server, worker):
    pass
```

Вызывается сразу после выхода из процесса воркера в рабочем процессе.

Вызываемый объект должен принимать две переменные экземпляра для **Arbiter** и только что завершившегося **Worker**.

### nworkers\_changed

**По умолчанию**:

```python
def nworkers_changed(server, new_value, old_value):
    pass
```

Вызывается сразу после изменения **num\_workers**.

Вызываемый объект должен принимать переменную экземпляра **Arbiter** и два целых числа **Worker** после и до изменения.

Если количество рабочих устанавливается впервые, то **old\_value** будет `None`.

### on\_exit

**По умолчанию**:

```python
def on_exit(server):
    pass
```

Вызывается непосредственно перед выходом из **Gunicorn**.

Вызываемый объект должен принимать одну переменную экземпляра для **Arbiter**.

## Механика сервера

### preload\_app

**Командная строка**: `--preload`

**По умолчанию**: `False`

Загрузите код приложения до того, как процессы воркеров будут разветвлены.

Предварительно загрузив приложение, вы можете сэкономить ресурсы оперативной памяти, а также ускорить загрузку сервера. Хотя, если вы откладываете загрузку приложения для каждого рабочего процесса, вы можете легко перезагрузить код приложения, перезапустив процессы воркеров.

### sendfile

**Командная строка**: `--no-sendfile`

**По умолчанию**: `None`

Отключает использование `sendfile()`.

Если не установлено, значение переменной среды **SENDFILE** используется для включения или отключения ее использования.

_Новое в версии 19.2_.

_Изменено в версии 19.4_: `--sendfile` заменен на `--no-sendfile`, чтобы фактически разрешить отключение.

_Изменено в версии 19.6_: добавлена поддержка переменной окружения **SENDFILE**.

### reuse\_port

**Командная строка**: `--reuse-port`

**По умолчанию**: `False`

Установите флаг **SO\_REUSEPORT** на сокете прослушивания.

_Новое в версии 19.8_.

### chdir

**Командная строка**: `--chdir`

**По умолчанию**: `'/home/docs/checkouts/readthedocs.org/user_builds/gunicorn-docs/checkouts/stable/docs/source'`

Измените каталог на указанный каталог перед загрузкой приложений.

### daemon

**Командная строка**: `-D` или `--daemon`

**По умолчанию**: `False`

Демонизировать процесс **Gunicorn**.

Отключает сервер от управляющего терминала и переходит в фоновый режим.

### raw\_env

**Командная строка**: `-e ENV` или `--env ENV`

**По умолчанию**: `[]`

Установите переменные среды в среде выполнения.

Должен быть список строк в формате `key=value`.

Например в командной строке:

```bash
$ gunicorn -b 127.0.0.1:8000 --env FOO=1 test:app
```

Или в файле конфигурации:

```ini
raw_env = ["FOO=1"]
```

### pidfile

**Командная строка**: `-p FILE` или `--pid FILE`

**По умолчанию**: `None`

Имя файла, используемое для файла **PID**.

Если не установлено, файл **PID** не будет записан.

### worker\_tmp\_dir

**Командная строка**: `--worker-tmp-dir DIR`

**По умолчанию**: `None`

Каталог, используемый для временного файла рабочего пульса.

Если не задано, будет использоваться временный каталог по умолчанию.

{% hint style="info" %}
Текущая система **heartbeat** включает вызов `os.fchmod` для обработчиков временных файлов и может заблокировать рабочий процесс на произвольное время, если каталог находится в файловой системе на диске.

См. [Как избежать чрезмерной блокировки Gunicorn в os.fchmod?](voprosy-otvety-gunicorn.md) для получения более подробной информации и решения, позволяющего избежать этой проблемы.
{% endhint %}

### user

**Командная строка**: `-u USER` или `--user USER`

**По умолчанию**: `1005`

Переключите рабочие процессы для запуска от имени этого пользователя.

Действительный идентификатор пользователя (в виде целого числа) или имя пользователя, которое можно получить с помощью вызова `pwd.getpwnam(value)` или `None`, чтобы не изменять пользователя рабочего процесса.

### group

**Командная строка**: `-g GROUP` или `--group GROUP`

**По умолчанию**: `205`

Переключите рабочий процесс на запуск от имени этой группы.

Действительный идентификатор группы (в виде целого числа) или имя пользователя, которое можно получить с помощью вызова `pwd.getgrnam(value)` или `None`, чтобы не изменять группу рабочих процессов.

### umask

**Командная строка**: `-m INT` или `--umask INT`

**По умолчанию**: `0`

Битовая маска для файлового режима для файлов, написанных **Gunicorn**.

Обратите внимание, что это влияет на разрешения сокетов unix.

Допустимое значение для вызова `os.umask(mode)` или строка, совместимая с `int(value, 0)` (`0` означает, что Python угадывает базу, поэтому такие значения, как `0`, `0xFF`, `0022`, допустимы для десятичных, шестнадцатеричных и восьмеричных представлений)

### initgroups

**Командная строка**: `--initgroups`

**По умолчанию**: `False`

Если `True`, задайте список доступа к группе рабочего процесса со всеми группами, членом которых является указанное имя пользователя, плюс указанный идентификатор группы.

_Новое в версии 19.7_.

### tmp\_upload\_dir

**По умолчанию**: `None`

Каталог для хранения временных данных запроса по мере их чтения.

Это может исчезнуть в ближайшем будущем.

Этот путь должен быть доступен для записи разрешениями процесса, установленными для рабочих процессов **Gunicorn**. Если не указано иное, **Gunicorn** выберет созданный системой временный каталог.

### secure\_scheme\_headers

**По умолчанию**: `{'X-FORWARDED-PROTOCOL': 'ssl', 'X-FORWARDED-PROTO': 'https', 'X-FORWARDED-SSL': 'on'}`

Словарь, содержащий заголовки и значения, которые внешний прокси-сервер использует для обозначения HTTPS-запросов. Они говорят **Gunicorn** установить для **wsgi.url\_scheme** значение **https**, чтобы ваше приложение могло сказать, что запрос безопасен.

Словарь должен сопоставлять имена заголовков в верхнем регистре с точными строковыми значениями. Сравнения значений чувствительны к регистру, в отличие от имен заголовков, поэтому убедитесь, что они точно совпадают с тем, что отправляет ваш внешний прокси-сервер при обработке HTTPS-запросов.

Важно, чтобы ваша конфигурация внешнего прокси-сервера гарантировала, что определенные здесь заголовки не могут быть переданы напрямую от клиента.

### forwarded\_allow\_ips

**Командная строка**: `--forwarded-allow-ips STRING`

**По умолчанию**: `'127.0.0.1'`.

IP-адреса внешнего интерфейса, с которого разрешено обрабатывать установленные безопасные заголовки (разделяется запятыми).

Установите `*`, чтобы отключить проверку IP-адресов внешнего интерфейса (полезно для настроек, когда вы заранее не знаете IP-адрес внешнего интерфейса, но по-прежнему доверяете среде).

По умолчанию значение переменной среды **FORWARDED\_ALLOW\_IPS**. Если он не определен, по умолчанию используется `'127.0.0.1'`.

### pythonpath

**Командная строка**: `--pythonpath STRING`

**По умолчанию**: `None`

Список каталогов, разделенных запятыми, для добавления к пути Python.

Например, `'/home/djangoprojects/myproject,/home/python/mylibrary'`.

### paste

**Командная строка**: `--paste STRING` или `--paster STRING`

**По умолчанию**: `None`

Загружает файл конфигурации **PasteDeploy**. Аргумент может содержать символ `#`, за которым следует имя раздела приложения из файла конфигурации, например, `production.ini#admin`.

В настоящее время использование альтернативных серверных блоков не поддерживается. Вместо этого используйте аргументы командной строки для управления конфигурацией сервера.

### proxy\_protocol

**Командная строка**: `--proxy-protocol`

**По умолчанию**: `False`

Включает обнаружение протокола **PROXY** (режим **PROXY**).

Разрешает совместное использование **HTTP** и **Proxy**. Это может быть полезно для работы с **stunnel** в качестве HTTPS-интерфейса и **Gunicorn** в качестве HTTP-сервера.

PROXY-протокол: [http://haproxy.1wt.eu/download/1.5/doc/proxy-protocol.txt](http://haproxy.1wt.eu/download/1.5/doc/proxy-protocol.txt)

Пример конфигурации **stunnel**:

```ini
[https]
protocol = proxy
accept  = 443
connect = 80
cert = /etc/ssl/certs/stunnel.pem
key = /etc/ssl/certs/stunnel.key
```

### proxy\_allow\_ips

**Командная строка**: `--proxy-allow-from`

**По умолчанию**: `'127.0.0.1'`.

IP-адреса внешнего интерфейса, с которых разрешено принимать прокси-запросы (через запятую).

Установите `*`, чтобы отключить проверку IP-адресов внешнего интерфейса (полезно для настроек, когда вы заранее не знаете IP-адрес внешнего интерфейса, но все же доверяете среде)

### raw\_paste\_global\_conf

**Командная строка**: `--paste-global CONF`

**По умолчанию**: `[]`

Задает глобальную переменную конфигурации **PasteDeploy** в форме `key=value`.

Опция может быть указана несколько раз.

Переменные передаются в точку входа **PasteDeploy**. Пример:

```bash
$ gunicorn -b 127.0.0.1:8000 --paste development.ini --paste-global FOO=1 --paste-global BAR=2
```

_Новое в версии 19.7_.

### strip\_header\_spaces

**Командная строка**: `--strip-header-spaces`

**По умолчанию**: `False`

Удаляет пробелы между именем заголовка и символом `:`.

Известно, что это вызывает уязвимости и не соответствует стандарту **HTTP/1.1**. См. [https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn](https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn).

Используйте с осторожностью и только в случае необходимости.

## Сокет сервера

### bind

**Командная строка**: `-b ADDRESS` или `--bind ADDRESS`

**По умолчанию**: `['127.0.0.1:8000']`

Сокет для привязки.

Строка вида: `HOST`, `HOST:PORT`, `unix:PATH`, `fd://FD`. IP является действительным `HOST`.

_Изменено в версии 20.0_: Добавлена поддержка `fd://FD`.

Можно связать несколько адресов, например:

```bash
$ gunicorn -b 127.0.0.1:8000 -b [::1]:8000 test:app
```

свяжет приложение `test:app` на локальном хосте как на интерфейсах **ipv6**, так и на **ipv4**.

Если определена переменная среды **PORT**, по умолчанию используется значение `['0.0.0.0:$PORT']`. Если он не определен, по умолчанию используется `['127.0.0.1:8000']`.

### backlog

**Командная строка**: `--backlog INT`

**По умолчанию**: `2048`

Максимальное количество ожидающих соединений.

Это относится к количеству клиентов, которые могут ожидать обслуживания. Превышение этого числа приводит к тому, что клиент получает сообщение об ошибке при попытке подключения. Это должно влиять только на серверы со значительной нагрузкой.

Должно быть положительным целым числом. Обычно устанавливается в диапазоне `64-2048`.

## Процессы воркера

### workers

**Командная строка**: `-w INT` или `--workers INT`

**По умолчанию**: `1`

Количество рабочих процессов для обработки запросов.

Положительное целое число, как правило, в диапазоне `2-4 x $(NUM_CORES)`. Вы захотите немного изменить это, чтобы найти лучшее для рабочей нагрузки вашего конкретного приложения.

По умолчанию значение переменной среды **WEB\_CONCURRENCY** устанавливается некоторыми поставщиками платформы как услуги, такими как **Heroku**. Если он не определен, по умолчанию используется значение `1`.

### worker\_class

**Командная строка**: `-k STRING` или `--worker-class STRING`

**По умолчанию**: `'sync'`.

Тип рабочих для использования.

Класс по умолчанию (**sync**) должен обрабатывать большинство «обычных» типов рабочих нагрузок. Вы захотите прочитать [Дизайн](dizain-gunicorn.md) для получения информации о том, когда вы можете выбрать один из других рабочих классов. Необходимые библиотеки можно установить с помощью функции **extras\_require** в **setuptools**.

Строка, относящаяся к одному из следующих объединенных классов:

* **sync**
* **eventlet** - Требуется `eventlet >= 0.24.1` (или установите его через `pip install gunicorn[eventlet]`)
* **gevent** - Требуется `gevent >= 1.4` (или установите его через `pip install gunicorn[gevent]`)
* **tornado** - Требуется `tornado >= 0.2` (или установите его через `pip install gunicorn[tornado]`)
* **gthread** - Python 2 требует установки пакета **futures** (или установите его через `pip install gunicorn[gthread]`)

При желании вы можете предоставить свой собственный рабочий процесс, предоставив **Gunicorn** путь Python к подклассу **gunicorn.workers.base.Worker**. Этот альтернативный синтаксис загрузит класс **gevent: gunicorn.workers.ggevent.GeventWorker**.

### threads

**Командная строка**: `--threads INT`

**По умолчанию**: `1`

Количество рабочих потоков для обработки запросов.

Запустите каждого рабочего с указанным количеством потоков.

Положительное целое число, как правило, в диапазоне `2-4 x $(NUM_CORES)`. Вы захотите немного изменить это, чтобы найти лучшее для рабочей нагрузки вашего конкретного приложения.

Если он не определен, по умолчанию используется значение `1`.

Этот параметр влияет только на рабочий тип **Gthread**.

{% hint style="info" %}
Если вы попытаетесь использовать тип рабочей роли **sync** и установите для параметра потоков значение более **1**, вместо этого будет использоваться тип рабочей роли **gthread**.
{% endhint %}

### worker\_connections

**Командная строка**: `--worker-connections INT`

**По умолчанию**: `1000`

Максимальное количество одновременных клиентов.

Этот параметр влияет только на рабочие типы **Eventlet** и **Gevent**.

### max\_requests

**Командная строка**: `--max-requests INT`

**По умолчанию**: `0`

Максимальное количество запросов, которые рабочий процесс обработает перед перезапуском.

Любое значение больше нуля будет ограничивать количество запросов, которые рабочий процесс будет обрабатывать перед автоматическим перезапуском. Это простой способ ограничить ущерб от утечек памяти.

Если установлено значение ноль (по умолчанию), то автоматические перезапуски рабочих процессов отключены.

### max\_requests\_jitter

**Командная строка**: `--max-requests-jitter INT`

**По умолчанию**: `0`

Максимальное отклонение для добавления к параметру **max\_requests**.

Отклонение приводит к тому, что перезапуск каждого рабочего процесса рандомизируется с помощью `randint(0, max_requests_jitter)`. Это предназначено для разнесения перезапусков воркеров, чтобы избежать одновременного перезапуска всех воркеров.

_Новое в версии 19.2_.

### timeout

**Командная строка**: `-t INT` или `--timeout INT`

**По умолчанию**: `30`

Воркеры, молчавшие более этого количества секунд, убиваются и перезапускаются.

Значение — положительное число или `0`. Установка его в `0` приводит к бесконечным тайм-аутам, полностью отключая тайм-ауты для всех рабочих процессов.

Как правило, тридцати секунд по умолчанию должно быть достаточно. Устанавливайте это значение заметно выше только в том случае, если вы уверены в последствиях для синхронизаторов. Для несинхронизирующих воркеров это просто означает, что рабочий процесс все еще обменивается данными и не привязан к продолжительности времени, необходимому для обработки одного запроса.

### graceful\_timeout

**Командная строка**: `--graceful-timeout INT`

**По умолчанию**: `30`

Тайм-аут для изящного перезапуска воркеров.

После получения сигнала перезапуска у воркеров есть столько времени, чтобы завершить обслуживание запросов. Воркеры, оставшиеся в живых после тайм-аута (начиная с получения сигнала перезапуска), принудительно убиваются.

### keepalive

**Командная строка**: `--keep-alive INT`

**По умолчанию**: `2`

Количество секунд ожидания запросов на соединение **Keep-Alive**.

Обычно устанавливается в диапазоне 1-5 секунд для серверов с прямым подключением к клиенту (например, когда у вас нет отдельного балансировщика нагрузки). Когда **Gunicorn** развернут за балансировщиком нагрузки, часто имеет смысл установить для него более высокое значение.

{% hint style="info" %}
**sync** воркера не поддерживает постоянные соединения и игнорирует этот параметр.
{% endhint %}
